language: java
sudo: required

services:
- docker
git:
  depth: 1

cache:
  directories:
  - "$HOME/.m2"

install: true
script: "./build.sh -b -s"

after_success:
  - if [[ "$TRAVIS_PULL_REQUEST" == "false" ]]; then
      docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD ;
      docker tag $(docker images --format "{{.ID}}" teiid/komodo ) $DOCKER_USERNAME/komodo:$(docker images --format "{{.Tag}}" teiid/komodo) ;
      docker images ;
      docker push $DOCKER_USERNAME/komodo ;
    fi
